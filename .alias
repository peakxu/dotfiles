#!/bin/bash

alias git_cleanup="git branch --merged master | egrep -iv '(master|production|staging)' | xargs -n 1 git branch -d"
alias git_cleanup_remote="git branch -r --merged master | egrep -iv '(master|production|staging)' | sed 's/origin\///g' | xargs -n 1 git push --delete origin"
alias be='bundle exec'
alias bivb='bundle install --path vendor/support'
alias dp='datapipeline'
alias dpi='datapipeline --id'
alias dpli='datapipeline --list-runs --id'
alias dplm='datapipeline --list-pipelines | grep peakxu'

function jenkins-build {
  gitbranch=$(git symbolic-ref --short HEAD)
  if [[ $? -eq 0 ]] ; then
    gitrepo=$(basename "$PWD")
    if [[ $? -eq 0 ]] ; then
        job_prefixes=( app gem )
        for job_prefix in "${job_prefixes[@]}"
        do
            curl -X POST https://github:kwajfh347f@jenkins.swipely.com/job/$job_prefix.$gitrepo/buildWithParameters?BRANCH=$gitbranch > /dev/null 2>&1 || true
        done
    fi
  fi
}
